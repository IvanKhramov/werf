---
title: Сценарии развертывания
permalink: usage/deploy/deployment_scenarios.html
---

## Обычное развертывание

Обычно развертывание осуществляется командой `werf converge`, которая собирает образы и развертывает приложение, но требует запуска из Git-репозитория приложения. Пример:

```shell
werf converge --repo <репозиторий>
```

Если требуется разделить шаги сборки и развертывания, то это можно сделать так:

```shell
werf build --repo <репозиторий>
```

```shell
werf converge --skip-build --repo <репозиторий>
```

## Развертывание без доступа к Git-репозиторию приложения

Если нужно развернуть приложение без доступа к Git-репозиторию приложения, то необходимо выполнить три шага:

1. Сборка образов и их публикация в container registry.

2. Публикация основного чарта и переданных ему параметров как *бандла* в OCI-репозиторий. Бандл содержит указатели на опубликованные в первом шаге образы.

3. Применение опубликованного бандла в кластер.

Первые два шага выполняются командой `werf bundle publish`, находясь в Git-репозитории приложения, например:

```shell
werf bundle publish --tag latest --repo <репозиторий>
```

А третий шаг выполняется командой `werf bundle apply` уже без необходимости находиться в Git-репозитории приложения, например:

```shell
werf bundle apply --tag latest --release myapp --namespace myapp-production --repo <репозиторий>
```

Конечный результат будет тот же самый, что и при использовании `werf converge`.

Если требуется разделить первый и второй шаг, то это можно сделать так:

```shell
werf build --repo <репозиторий>
```

```
werf bundle publish --skip-build --tag latest --repo <репозиторий>
```

## Развертывание сторонним инструментом

Если нужно выполнить применение конечных манифестов приложения не с werf, а с использованием другого инструмента (kubectl, Helm, ...), то необходимо выполнить три шага:

1. Сборка образов и их публикация в container registry.

2. Формирование конечных манифестов.

3. Развертывание получившихся манифестов в кластер используя сторонний инструмент.

Первые два шага выполняются командой `werf render`, находясь в Git-репозитории приложения:

```shell
werf render --output manifests.yaml --repo <репозиторий>
```

Теперь полученные манифесты можно передать в сторонний инструмент для дальнейшего развертывания, например:

```shell
kubectl apply -f manifests.yaml
```

> Обратите внимание, что некоторые специальные возможности werf вроде возможности изменения порядка развертывания ресурсов на основании их веса (аннотация `werf.io/weight`) скорее всего не будут поддерживаться при применении манифестов сторонним инструментом.

Если требуется разделить первый и второй шаг, то это можно сделать так:

```shell
werf build --repo <репозиторий>
```

```
werf render --skip-build --output manifests.yaml --repo <репозиторий>
```

## Развертывание сторонним инструментом без доступа к Git-репозиторию приложения

Если нужно выполнить применение конечных манифестов приложения не с werf, а с использованием другого инструмента (kubectl, Helm, ...), при этом не имея доступа к Git-репозиторию приложения, то необходимо выполнить три шага:

1. Сборка образов и их публикация в container registry.

2. Публикация основного чарта и переданных ему параметров как *бандла* в OCI-репозиторий. Бандл содержит указатели на опубликованные в первом шаге образы.

3. Формирование из бандла конечных манифестов.

4. Развертывание получившихся манифестов в кластер используя сторонний инструмент.

Первые два шага выполняются командой `werf bundle publish`, находясь в Git-репозитории приложения:

```shell
werf bundle publish --tag latest --repo <репозиторий>
```

А третий шаг выполняется командой `werf bundle render` уже без необходимости находиться в Git-репозитории приложения, например:

```shell
werf bundle render --output manifests.yaml --tag latest --release myapp --namespace myapp-production --repo <репозиторий>
```

Теперь полученные манифесты можно передать в сторонний инструмент для дальнейшего развертывания, например:

```shell
kubectl apply -f manifests.yaml
```

> Обратите внимание, что некоторые специальные возможности werf вроде возможности изменения порядка развертывания ресурсов на основании их веса (аннотация `werf.io/weight`) скорее всего не будут поддерживаться при применении манифестов сторонним инструментом.

Если требуется разделить первый и второй шаг, то это можно сделать так:

```shell
werf build --repo <репозиторий>
```

```
werf bundle publish --skip-build --tag latest --repo <репозиторий>
```

## Удаление развернутого приложения

Удалить развернутое приложение можно командой `werf dismiss`, запущенной из Git-репозитория приложения, например:

```shell
werf dismiss --env staging
```
