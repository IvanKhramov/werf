---
title: Чарты, бандлы
permalink: usage/distribute/charts.html
---

## Публикация чарта/бандла

Публикация *чарта* для его дальнейшего использования в качестве зависимого чарта или его развертывания сторонним ПО осуществляется командой `werf bundle publish`. Также и публикация *бандла* для его дальнейшего развертывания с werf осуществляется той же командой `werf bundle publish`, так как бандл по существу является чартом.

Опубликовать чарт/бандл в OCI-репозиторий можно следующим способом:

1. Создайте `werf.yaml`, если его ещё нет:
   
   ```yaml
   # werf.yaml:
   project: mychart
   configVersion: 1
   ```

2. Разместите файлы чарта/бандла в директории основного чарта (по умолчанию `.helm` в корне Git-репозитория). Заметьте, что при публикации в чарт/бандл будут включены *только* следующие файлы и директории:
   
   ```
   .helm/
     charts/
     templates/
     crds/
     files/
     Chart.yaml
     values.yaml
     values.schema.json
     LICENSE
     README.md
   ```
   
   Для публикации дополнительных файлов/директорий выставьте переменную окружения `WERF_BUNDLE_SCHEMA_NONSTRICT=1`, после чего будут публиковаться *все* файлы и директории в директории основного чарта, а не только вышеуказанные.

3. Следующей командой соберите и опубликуйте описанные в `werf.yaml` образы (если таковые есть) и опубликуйте содержимое `.helm` как чарт/бандл `example.org/charts/mychart:latest` в виде OCI-образа:
   
   ```shell
   werf bundle publish --repo example.org/charts
   ```

Если требуется разделить сборку/публикацию образов и публикацию чарта/бандла, то это можно сделать так:

```shell
werf build --repo example.org/charts
```

```shell
werf bundle publish --skip-build --repo example.org/charts
```

## Публикация нескольких чартов/бандлов из одного Git-репозитория

Разместите `.helm` с содержимым чарта/бандла и соответствующий ему `werf.yaml` в отдельную директорию для каждого чарта/бандла:

```
chart1/
  .helm/
    templates/
    ...
  werf.yaml
chart2/
  .helm/
    templates/
    ...
  werf.yaml
```

Теперь опубликуйте каждый чарт/бандл по отдельности:

```shell
cd chart1
werf bundle publish --repo example.org/charts

cd ../chart2
werf bundle publish --repo example.org/charts
```

## Исключение файлов или директорий из публикуемого чарта/бандла

Файл `.helmignore`, находящийся в корне чарта/бандла, может содержать фильтры по именам файлов, при соответствии которым файлы или директории не будут добавляться в чарт/бандл при публикации. Формат правил такой же, как и в [.gitignore](https://git-scm.com/docs/gitignore), за исключением:

- `**` не поддерживается;

- `!` в начале строки не поддерживается;

- `.helmignore` не исключает сам себя по умолчанию.

Также опция `--disable-default-values` для команды `werf bundle publish` позволяет исключить из публикуемого чарта/бандла файл `values.yaml`.

## Версионирование чартов/бандлов

По умолчанию чарт/бандл публикуется с тегом `latest`. Указать иной тег, например семантическую версию для публикуемого чарта/бандла, можно опцией `--tag`:

```shell
werf bundle publish --repo example.org/charts --tag v1.0.0
```

Результат: опубликован чарт/бандл `example.org/charts/mychart:v1.0.0`.

Если при публикации будет обнаружено, что в OCI-репозитории уже существует чарт/бандл с таким тегом, то чарт/бандл в репозитории будет перезаписан.

## Container Registries, поддерживающие публикацию чартов/бандлов

Для публикации чартов/бандлов требуется Container Registry, поддерживающий спецификацию OCI ([Open Container Initiative](https://github.com/opencontainers/image-spec)). Список наиболее популярных Container Registries, совместимость с которыми была проверена:

| Container Registry        | Поддерживает публикацию чартов/бандлов |
| ------------------------- |:--------------------------------------:|
| AWS ECR                   | +                                      |
| Azure CR                  | +                                      |
| Docker Hub                | +                                      |
| GCR                       | +                                      |
| GitHub Packages           | +                                      |
| GitLab Registry           | +                                      |
| Harbor                    | +                                      |
| JFrog Artifactory         | +                                      |
| Yandex Container Registry | +                                      |
| Quay                      | -                                      |
